jQuery.trumbowyg={langs:{en:{viewHTML:"View HTML",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target",width:"Width"}},plugins:{},svgPath:null,svgAbsoluteUseHref:!1,hideButtonTexts:null},Object.defineProperty(jQuery.trumbowyg,"defaultOptions",{value:{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,autogrowOnEnter:!1,imageWidthModalEdit:!1,hideButtonTexts:null,prefix:"trumbowyg-",tagClasses:{},semantic:!0,semanticKeepAttributes:!1,resetCss:!1,removeformatPasted:!1,tabToIndent:!1,tagsToRemove:[],tagsToKeep:["hr","img","embed","iframe","input"],btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["insertImage"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},changeActiveDropdownIcon:!1,inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],plugins:{},urlProtocol:!1,minimalLinks:!1,defaultLinkTarget:void 0,svgPath:null},writable:!1,enumerable:!0,configurable:!1}),function(a,b,c,d){'use strict';d.fn.trumbowyg=function(a,b){if(a===Object(a)||!a)return this.each(function(){d(this).data("trumbowyg")||d(this).data("trumbowyg",new e(this,a))});if(1===this.length)try{var c=d(this).data("trumbowyg");switch(a){case"execCmd":return c.execCmd(b.cmd,b.param,b.forceCss,b.skipTrumbowyg);case"openModal":return c.openModal(b.title,b.content);case"closeModal":return c.closeModal();case"openModalInsert":return c.openModalInsert(b.title,b.fields,b.callback);case"saveRange":return c.saveRange();case"getRange":return c.range;case"getRangeText":return c.getRangeText();case"restoreRange":return c.restoreRange();case"enable":return c.setDisabled(!1);case"disable":return c.setDisabled(!0);case"toggle":return c.toggle();case"destroy":return c.destroy();case"empty":return c.empty();case"html":return c.html(b);}}catch(a){}return!1};var e=function(e,f){var g=this,i=d.trumbowyg;g.doc=e.ownerDocument||c,g.$ta=d(e),g.$c=d(e),f=f||{},g.lang=null!=f.lang||null!=i.langs[f.lang]?d.extend(!0,{},i.langs.en,i.langs[f.lang]):i.langs.en,g.hideButtonTexts=null==i.hideButtonTexts?f.hideButtonTexts:i.hideButtonTexts;var j=null==i.svgPath?f.svgPath:i.svgPath;if(g.hasSvg=!1!==j,!1!==j&&(i.svgAbsoluteUseHref||0===d("#trumbowyg-icons",g.doc).length)){if(null==j){var k=d("script[src]");k.each(function(a,b){var c=b.src,d=c.match("trumbowyg(.min)?.js");null!=d&&(j=c.substring(0,c.indexOf(d[0]))+"ui/icons.svg")})}if(null==j)console.warn("You must define svgPath: https://goo.gl/CfTY9U");else if(!i.svgAbsoluteUseHref){var l=g.doc.createElement("div");l.id="trumbowyg-icons",g.doc.body.insertBefore(l,g.doc.body.childNodes[0]),d.ajax({async:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"xml",crossDomain:!0,url:j,data:null,beforeSend:null,complete:null,success:function(a){l.innerHTML=new XMLSerializer().serializeToString(a.documentElement)}})}}var m=g.doc.querySelector("base")?b.location.href.split(/[?#]/)[0]:"";g.svgPath=i.svgAbsoluteUseHref?j:m;var n=g.lang.header,h=function(){return(b.chrome||b.Intl&&Intl.v8BreakIterator)&&"CSS"in b};g.btnsDef={viewHTML:{fn:"toggle",class:"trumbowyg-not-disable"},undo:{isSupported:h,key:"Z"},redo:{isSupported:h,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:n+" 1"},h2:{fn:"formatBlock",title:n+" 2"},h3:{fn:"formatBlock",title:n+" 3"},h4:{fn:"formatBlock",title:n+" 4"},h5:{fn:"formatBlock",title:n+" 5"},h6:{fn:"formatBlock",title:n+" 6"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{class:"trumbowyg-not-disable"},close:{fn:"destroy",class:"trumbowyg-not-disable"},formatting:{dropdown:["p","blockquote","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}},g.o=d.extend(!0,{},i.defaultOptions,f),g.o.hasOwnProperty("imgDblClickHandler")||(g.o.imgDblClickHandler=g.getDefaultImgDblClickHandler()),g.urlPrefix=g.setupUrlPrefix(),g.disabled=g.o.disabled||"TEXTAREA"===e.nodeName&&e.disabled,f.btns?g.o.btns=f.btns:!g.o.semantic&&(g.o.btns[3]=["bold","italic","underline","strikethrough"]),d.each(g.o.btnsDef,function(a,b){g.addBtnDef(a,b)}),g.eventNamespace="trumbowyg-event",g.keys=[],g.tagToButton={},g.tagHandlers=[],g.pasteHandlers=[].concat(g.o.pasteHandlers),g.isIE=-1!==a.userAgent.indexOf("MSIE")||-1!==a.appVersion.indexOf("Trident/"),g.isMac=-1!==a.platform.toUpperCase().indexOf("MAC"),g.init()};e.prototype={DEFAULT_SEMANTIC_MAP:{b:"strong",i:"em",s:"del",strike:"del",div:"p"},init:function(){var a=this;a.height=a.$ta.height(),a.initPlugins();try{a.doc.execCommand("enableObjectResizing",!1,!1),a.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(a){}a.buildEditor(),a.buildBtnPane(),a.fixedBtnPaneEvents(),a.buildOverlay(),setTimeout(function(){a.disabled&&a.setDisabled(!0),a.$c.trigger("tbwinit")})},addBtnDef:function(a,b){this.btnsDef[a]=d.extend(b,this.btnsDef[a]||{})},setupUrlPrefix:function(){var a=this.o.urlProtocol;return a?"string"==typeof a?a.replace("://","")+"://":"https://":void 0},buildEditor:function(){var a=this,c=a.o.prefix,e="";a.$box=d("<div/>",{class:c+"box "+c+"editor-visible "+c+a.o.lang+" trumbowyg"}),a.isTextarea=a.$ta.is("textarea"),a.isTextarea?(e=a.$ta.val(),a.$ed=d("<div/>"),a.$box.insertAfter(a.$ta).append(a.$ed,a.$ta)):(a.$ed=a.$ta,e=a.$ed.html(),a.$ta=d("<textarea/>",{name:a.$ta.attr("id"),height:a.height}).val(e),a.$box.insertAfter(a.$ed).append(a.$ta,a.$ed),a.syncCode()),a.$ta.addClass(c+"textarea").attr("tabindex",-1),a.$ed.addClass(c+"editor").attr({contenteditable:!0,dir:a.lang._dir||"ltr"}).html(e),a.o.tabindex&&a.$ed.attr("tabindex",a.o.tabindex),a.$c.is("[placeholder]")&&a.$ed.attr("placeholder",a.$c.attr("placeholder")),a.$c.is("[spellcheck]")&&a.$ed.attr("spellcheck",a.$c.attr("spellcheck")),a.o.resetCss&&a.$ed.addClass(c+"reset-css"),a.o.autogrow||a.$ta.add(a.$ed).css({height:a.height}),a.semanticCode(),a.o.autogrowOnEnter&&a.$ed.addClass(c+"autogrow-on-enter");var f,g=!1,h=!1;a.$ed.on("dblclick","img",a.o.imgDblClickHandler).on("keydown",function(b){var c=b.which;if((8===c||13===c||46===c)&&a.toggleSpan(!0),(b.ctrlKey||b.metaKey)&&!b.altKey){g=!0;var d=a.keys[String.fromCharCode(b.which).toUpperCase()];try{return a.execCmd(d.fn,d.param),!1}catch(a){}}else if(a.o.tabToIndent&&"Tab"===b.key)try{return b.shiftKey?a.execCmd("outdent",!0,null):a.execCmd("indent",!0,null),!1}catch(a){}}).on("compositionstart compositionupdate",function(){h=!0}).on("keyup compositionend",function(b){if("compositionend"===b.type)h=!1;else if(h)return;var c=b.which;if(!(37<=c&&40>=c)){if((8===c||13===c||46===c)&&a.toggleSpan(),(b.ctrlKey||b.metaKey)&&(89===c||90===c))a.semanticCode(!1,!0),a.$c.trigger("tbwchange");else if(!g&&17!==c){var d=!a.isIE||"compositionend"===b.type;a.semanticCode(!1,d&&13===c),a.$c.trigger("tbwchange")}else"undefined"==typeof b.which&&a.semanticCode(!1,!1,!0);setTimeout(function(){g=!1},50)}}).on("mouseup keydown keyup",function(b){(b.ctrlKey||b.metaKey)&&!b.altKey||setTimeout(function(){g=!1},50),clearTimeout(f),f=setTimeout(function(){a.updateButtonPaneStatus()},50)}).on("focus blur",function(b){if("blur"===b.type&&a.clearButtonPaneStatus(),a.$c.trigger("tbw"+b.type),a.o.autogrowOnEnter){if(a.autogrowOnEnterDontClose)return;"focus"===b.type?(a.autogrowOnEnterWasFocused=!0,a.autogrowEditorOnEnter()):!a.o.autogrow&&(a.$ed.css({height:a.$ed.css("min-height")}),a.$c.trigger("tbwresize"))}}).on("keyup focus",function(){a.$ta.val().match(/<.*>/)||a.$ed.html().match(/<.*>/)||setTimeout(function(){var b=a.isIE?"<p>":"p";a.doc.execCommand("formatBlock",!1,b),a.syncCode()},0)}).on("cut drop",function(){setTimeout(function(){a.semanticCode(!1,!0),a.$c.trigger("tbwchange")},0)}).on("paste",function(c){if(a.o.removeformatPasted){c.preventDefault(),b.getSelection&&b.getSelection().deleteFromDocument&&b.getSelection().deleteFromDocument();try{var e=b.clipboardData.getData("Text");try{a.doc.selection.createRange().pasteHTML(e)}catch(b){a.doc.getSelection().getRangeAt(0).insertNode(a.doc.createTextNode(e))}a.$c.trigger("tbwchange",c)}catch(b){a.execCmd("insertText",(c.originalEvent||c).clipboardData.getData("text/plain"))}}d.each(a.pasteHandlers,function(a,b){b(c)}),setTimeout(function(){a.semanticCode(!1,!0),a.$c.trigger("tbwpaste",c),a.$c.trigger("tbwchange")},0)}),a.$ta.on("keyup",function(){a.$c.trigger("tbwchange")}).on("paste",function(){setTimeout(function(){a.$c.trigger("tbwchange")},0)}),d(a.doc.body).on("keydown."+a.eventNamespace,function(b){if(27===b.which&&1<=d("."+c+"modal-box").length)return a.closeModal(),!1})},autogrowEditorOnEnter:function(){var a=this;a.$ed.removeClass("autogrow-on-enter");var b=a.$ed[0].clientHeight;a.$ed.height("auto");var c=a.$ed[0].scrollHeight;a.$ed.addClass("autogrow-on-enter"),b!==c&&(a.$ed.height(b),setTimeout(function(){a.$ed.css({height:c}),a.$c.trigger("tbwresize")},0))},buildBtnPane:function(){var a=this,b=a.o.prefix,c=a.$btnPane=d("<div/>",{class:b+"button-pane"});d.each(a.o.btns,function(e,f){d.isArray(f)||(f=[f]);var g=d("<div/>",{class:b+"button-group "+(0<=f.indexOf("fullscreen")?b+"right":"")});d.each(f,function(b,c){try{a.isSupportedBtn(c)&&g.append(a.buildBtn(c))}catch(a){}}),0<g.html().trim().length&&c.append(g)}),a.$box.prepend(c)},buildBtn:function(a){var b=this,c=b.o.prefix,e=b.btnsDef[a],f=e.dropdown,g=null==e.hasIcon||e.hasIcon,h=b.lang[a]||a,i=d("<button/>",{type:"button",class:c+a+"-button "+(e.class||"")+(g?"":" "+c+"textual-button"),html:b.hasSvg&&g?"<svg><use xlink:href=\""+b.svgPath+"#"+c+(e.ico||a).replace(/([A-Z]+)/g,"-$1").toLowerCase()+"\"/></svg>":b.hideButtonTexts?"":e.text||e.title||b.lang[a]||a,title:(e.title||e.text||h)+(e.key?" ("+(b.isMac?"Cmd":"Ctrl")+" + "+e.key+")":""),tabindex:-1,mousedown:function(){return((!f||d("."+a+"-"+c+"dropdown",b.$box).is(":hidden"))&&d("body",b.doc).trigger("mousedown"),!b.$btnPane.hasClass(c+"disable")&&!b.$box.hasClass(c+"disabled")||d(this).hasClass(c+"active")||d(this).hasClass(c+"not-disable"))&&(b.execCmd(!!f&&"dropdown"||e.fn||a,e.param||a,e.forceCss),!1)}});if(f){i.addClass(c+"open-dropdown");var j=c+"dropdown",k={class:j+"-"+a+" "+j+" "+c+"fixed-top "+(e.dropdownClass||"")};k["data-"+j]=a;var l=d("<div/>",k);d.each(f,function(a,c){b.btnsDef[c]&&b.isSupportedBtn(c)&&l.append(b.buildSubBtn(c))}),b.$box.append(l.hide())}else e.key&&(b.keys[e.key]={fn:e.fn||a,param:e.param||a});return f||(b.tagToButton[(e.tag||a).toLowerCase()]=a),i},buildSubBtn:function(a){var b=this,c=b.o.prefix,e=b.btnsDef[a],f=null==e.hasIcon||e.hasIcon;return e.key&&(b.keys[e.key]={fn:e.fn||a,param:e.param||a}),b.tagToButton[(e.tag||a).toLowerCase()]=a,d("<button/>",{type:"button",class:c+a+"-dropdown-button "+(e.class||"")+(e.ico?" "+c+e.ico+"-button":""),html:b.hasSvg&&f?"<svg><use xlink:href=\""+b.svgPath+"#"+c+(e.ico||a).replace(/([A-Z]+)/g,"-$1").toLowerCase()+"\"/></svg>"+(e.text||e.title||b.lang[a]||a):e.text||e.title||b.lang[a]||a,title:e.key?"("+(b.isMac?"Cmd":"Ctrl")+" + "+e.key+")":null,style:e.style||null,mousedown:function(){return d("body",b.doc).trigger("mousedown"),b.execCmd(e.fn||a,e.param||a,e.forceCss),!1}})},isSupportedBtn:function(a){try{return this.btnsDef[a].isSupported()}catch(a){}return!0},buildOverlay:function(){var a=this;return a.$overlay=d("<div/>",{class:a.o.prefix+"overlay"}).appendTo(a.$box),a.$overlay},showOverlay:function(){var a=this;d(b).trigger("scroll"),a.$overlay.fadeIn(200),a.$box.addClass(a.o.prefix+"box-blur")},hideOverlay:function(){var a=this;a.$overlay.fadeOut(50),a.$box.removeClass(a.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var a=this,c=a.o.fixedFullWidth,e=a.$box;a.o.fixedBtnPane&&(a.isFixed=!1,d(b).on("scroll."+a.eventNamespace+" resize."+a.eventNamespace,function(){if(e){a.syncCode();var f=d(b).scrollTop(),g=e.offset().top+1,h=a.$btnPane,i=h.outerHeight()-2;0<f-g&&0>f-g-a.height?(!a.isFixed&&(a.isFixed=!0,h.css({position:"fixed",top:0,left:c?0:"auto",zIndex:7}),a.$box.css({paddingTop:h.height()})),h.css({width:c?"100%":e.width()-1}),d("."+a.o.prefix+"fixed-top",e).css({position:c?"fixed":"absolute",top:c?i:i+(f-g),zIndex:15})):a.isFixed&&(a.isFixed=!1,h.removeAttr("style"),a.$box.css({paddingTop:0}),d("."+a.o.prefix+"fixed-top",e).css({position:"absolute",top:i}))}}))},setDisabled:function(a){var b=this,c=b.o.prefix;b.disabled=a,a?b.$ta.attr("disabled",!0):b.$ta.removeAttr("disabled"),b.$box.toggleClass(c+"disabled",a),b.$ed.attr("contenteditable",!a)},destroy:function(){var a=this,c=a.o.prefix;a.isTextarea?a.$box.after(a.$ta.css({height:""}).val(a.html()).removeClass(c+"textarea").show()):a.$box.after(a.$ed.css({height:""}).removeClass(c+"editor").removeAttr("contenteditable").removeAttr("dir").html(a.html()).show()),a.$ed.off("dblclick","img"),a.destroyPlugins(),a.$box.remove(),a.$c.removeData("trumbowyg"),d("body").removeClass(c+"body-fullscreen"),a.$c.trigger("tbwclose"),d(b).off("scroll."+a.eventNamespace+" resize."+a.eventNamespace),d(a.doc.body).off("keydown."+a.eventNamespace)},empty:function(){this.$ta.val(""),this.syncCode(!0)},toggle:function(){var a=this,b=a.o.prefix;a.o.autogrowOnEnter&&(a.autogrowOnEnterDontClose=!a.$box.hasClass(b+"editor-hidden")),a.semanticCode(!1,!0),a.$c.trigger("tbwchange"),setTimeout(function(){a.doc.activeElement.blur(),a.$box.toggleClass(b+"editor-hidden "+b+"editor-visible"),a.$btnPane.toggleClass(b+"disable"),d("."+b+"viewHTML-button",a.$btnPane).toggleClass(b+"active"),a.$box.hasClass(b+"editor-visible")?a.$ta.attr("tabindex",-1):a.$ta.removeAttr("tabindex"),a.o.autogrowOnEnter&&!a.autogrowOnEnterDontClose&&a.autogrowEditorOnEnter()},0)},toggleSpan:function(a){var b=this;b.$ed.find("span").each(function(){!0===a?d(this).attr("data-tbw-flag",!0):d(this).attr("data-tbw-flag")?d(this).removeAttr("data-tbw-flag"):d(this).contents().unwrap()})},dropdown:function(a){var c=this,f=d("body",c.doc),g=c.o.prefix,h=d("[data-"+g+"dropdown="+a+"]",c.$box),i=d("."+g+a+"-button",c.$btnPane),j=h.is(":hidden");if(f.trigger("mousedown"),j){var k=i.offset().left;i.addClass(g+"active"),h.css({position:"absolute",top:i.offset().top-c.$btnPane.offset().top+i.outerHeight(),left:c.o.fixedFullWidth&&c.isFixed?k:k-c.$btnPane.offset().left}).show(),d(b).trigger("scroll"),f.on("mousedown."+c.eventNamespace,function(a){h.is(a.target)||(d("."+g+"dropdown",c.$box).hide(),d("."+g+"active",c.$btnPane).removeClass(g+"active"),f.off("mousedown."+c.eventNamespace))})}},html:function(a){var b=this;return null==a?b.$ta.val():(b.$ta.val(a),b.syncCode(!0),b.$c.trigger("tbwchange"),b)},syncTextarea:function(){var a=this;a.$ta.val(0<a.$ed.text().trim().length||0<a.$ed.find(a.o.tagsToKeep.join(",")).length?a.$ed.html():"")},syncCode:function(a){var b=this;if(!a&&b.$ed.is(":visible"))b.syncTextarea();else{var c=d("<div>").html(b.$ta.val()),e=d("<div>").append(c);d(b.o.tagsToRemove.join(","),e).remove(),b.$ed.html(e.contents().html())}if(b.o.autogrow&&(b.height=b.$ed.height(),b.height!==b.$ta.css("height")&&(b.$ta.css({height:b.height}),b.$c.trigger("tbwresize"))),b.o.autogrowOnEnter){b.$ed.height("auto");var f=b.autogrowOnEnterWasFocused?b.$ed[0].scrollHeight:b.$ed.css("min-height");f!==b.$ta.css("height")&&(b.$ed.css({height:f}),b.$c.trigger("tbwresize"))}},semanticCode:function(a,b,c){var e=this;e.saveRange(),e.syncCode(a);var f=!0;if(e.range&&e.range.collapsed&&(f=!1),e.o.semantic){if(e.semanticTag("b",e.o.semanticKeepAttributes),e.semanticTag("i",e.o.semanticKeepAttributes),e.semanticTag("s",e.o.semanticKeepAttributes),e.semanticTag("strike",e.o.semanticKeepAttributes),b){var g=e.o.inlineElementsSelector;e.$ed.contents().filter(function(){return 3===this.nodeType&&0<this.nodeValue.trim().length}).wrap("<span data-tbw/>");var h=function(a){if(0!==a.length){var b=a.nextUntil(":not("+g+")").addBack().wrapAll("<p/>").parent(),c=b.nextAll(g).first();b.next("br").remove(),h(c)}};h(e.$ed.children(g).first()),e.semanticTag("div",!0),d("[data-tbw]",e.$ed).contents().unwrap(),e.$ed.find("p:empty").remove()}!c&&f&&e.restoreRange(),e.syncTextarea()}},semanticTag:function(a,b,c){var e,f=this,g=a;if(null!=this.o.semantic&&"object"==typeof this.o.semantic&&this.o.semantic.hasOwnProperty(a))e=this.o.semantic[a];else if(!0===this.o.semantic&&this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(a))e=this.DEFAULT_SEMANTIC_MAP[a];else return;c&&(a=e,e=g),d(a,this.$ed).each(function(){var a=!1,c=d(this);if(0===c.contents().length)return!1;f.range.startContainer.parentNode&&f.range.startContainer.parentNode===this&&(a=!0);var g=d("<"+e+"/>");g.insertBefore(c),b&&d.each(c.prop("attributes"),function(){g.attr(this.name,this.value)}),g.html(c.html()),c.remove(),!0==a&&(f.range.selectNodeContents(g.get(0)),f.range.collapse(!1))})},createLink:function(){for(var a,b,c,e=this,f=e.doc.getSelection(),g=f.getRangeAt(0),h=f.focusNode,i=new XMLSerializer().serializeToString(g.cloneContents())||g+"";0>["A","DIV"].indexOf(h.nodeName);)h=h.parentNode;if(h&&"A"===h.nodeName){var j=d(h);i=j.text(),a=j.attr("href"),e.o.minimalLinks||(b=j.attr("title"),c=j.attr("target")||e.o.defaultLinkTarget);var k=e.doc.createRange();k.selectNode(h),f.removeAllRanges(),f.addRange(k)}e.saveRange();var l={url:{label:e.lang.linkUrl||"URL",required:!0,value:a},text:{label:e.lang.text,value:i}};e.o.minimalLinks||d.extend(l,{title:{label:e.lang.title,value:b},target:{label:e.lang.target,value:c}}),e.openModalInsert(e.lang.createLink,l,function(a){var b=e.prependUrlPrefix(a.url);if(!b.length)return!1;var c=d(["<a href=\"",b,"\">",a.text||a.url,"</a>"].join(""));return a.title&&c.attr("title",a.title),(a.target||e.o.defaultLinkTarget)&&c.attr("target",a.target||e.o.defaultLinkTarget),e.range.deleteContents(),e.range.insertNode(c[0]),e.syncCode(),e.$c.trigger("tbwchange"),!0})},prependUrlPrefix:function(a){var b=this;if(!b.urlPrefix)return a;if(/^([a-z][-+.a-z0-9]*:|\/|#)/i.test(a))return a;return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)?"mailto:"+a:b.urlPrefix+a},unlink:function(){var a=this,b=a.doc.getSelection(),c=b.focusNode;if(b.isCollapsed){for(;0>["A","DIV"].indexOf(c.nodeName);)c=c.parentNode;if(c&&"A"===c.nodeName){var d=a.doc.createRange();d.selectNode(c),b.removeAllRanges(),b.addRange(d)}}a.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var a=this;a.saveRange();var b={url:{label:"URL",required:!0},alt:{label:a.lang.description,value:a.getRangeText()}};a.o.imageWidthModalEdit&&(b.width={}),a.openModalInsert(a.lang.insertImage,b,function(b){a.execCmd("insertImage",b.url,!1,!0);var c=d("img[src=\""+b.url+"\"]:not([alt])",a.$box);return c.attr("alt",b.alt),a.o.imageWidthModalEdit&&c.attr({width:b.width}),a.syncCode(),a.$c.trigger("tbwchange"),!0})},fullscreen:function(){var a,c=this,e=c.o.prefix,f=e+"fullscreen",g=f+"-placeholder",h=c.$box.outerHeight();c.$box.toggleClass(f),a=c.$box.hasClass(f),a?c.$box.before(d("<div/>",{class:g}).css({height:h})):d("."+g).remove(),d("body").toggleClass(e+"body-fullscreen",a),d(b).trigger("scroll"),c.$c.trigger("tbw"+(a?"open":"close")+"fullscreen")},execCmd:function(a,c,e,f){var g=this;f=!!f||"","dropdown"!==a&&g.$ed.focus(),"strikethrough"===a&&g.o.semantic&&g.semanticTag("strike",g.o.semanticKeepAttributes,!0);try{g.doc.execCommand("styleWithCSS",!1,e||!1)}catch(a){}try{g[a+f](c)}catch(e){try{a(c)}catch(e){"insertHorizontalRule"===a?c=void 0:"formatBlock"==a&&g.isIE&&(c="<"+c+">"),g.doc.execCommand(a,!1,c),g.syncCode(),g.semanticCode(!1,!0);try{var h=b.getSelection().focusNode;d(b.getSelection().focusNode.parentNode).hasClass("trumbowyg-editor")||(h=b.getSelection().focusNode.parentNode);var i=g.o.tagClasses[c];i&&d(h).addClass(i)}catch(a){}}"dropdown"!==a&&(g.updateButtonPaneStatus(),g.$c.trigger("tbwchange"))}},openModal:function(a,c,e){var f=this,g=f.o.prefix;if(e=!1!==e,0<d("."+g+"modal-box",f.$box).length)return!1;f.o.autogrowOnEnter&&(f.autogrowOnEnterDontClose=!0),f.saveRange(),f.showOverlay(),f.$btnPane.addClass(g+"disable");var h=d("<div/>",{class:g+"modal "+g+"fixed-top"}).css({top:f.$box.offset().top+f.$btnPane.height(),zIndex:99999}).appendTo(d(f.doc.body));f.$overlay.one("click",function(){return h.trigger("tbwcancel"),!1});var i=e?d("<form/>",{action:"",html:c}).on("submit",function(){return h.trigger("tbwconfirm"),!1}).on("reset",function(){return h.trigger("tbwcancel"),!1}).on("submit reset",function(){f.o.autogrowOnEnter&&(f.autogrowOnEnterDontClose=!1)}):c;var j=d("<div/>",{class:g+"modal-box",html:i}).css({top:"-"+f.$btnPane.outerHeight(),opacity:0,paddingBottom:e?null:"5%"}).appendTo(h).animate({top:0,opacity:1},100);return a&&d("<span/>",{text:a,class:g+"modal-title"}).prependTo(j),e&&(d("input:first",j).focus(),f.buildModalBtn("submit",j),f.buildModalBtn("reset",j),h.height(j.outerHeight()+10)),d(b).trigger("scroll"),f.$c.trigger("tbwmodalopen"),h},buildModalBtn:function(a,b){var c=this,e=c.o.prefix;return d("<button/>",{class:e+"modal-button "+e+"modal-"+a,type:a,text:c.lang[a]||a}).appendTo(d("form",b))},closeModal:function(){var a=this,b=a.o.prefix;a.$btnPane.removeClass(b+"disable"),a.$overlay.off();var c=d("."+b+"modal-box",d(a.doc.body));c.animate({top:"-"+c.height()},100,function(){c.parent().remove(),a.hideOverlay(),a.$c.trigger("tbwmodalclose")}),a.restoreRange()},openModalInsert:function(a,b,c){var e=this,f=e.o.prefix,g=e.lang,h="";return d.each(b,function(b,c){var d=c.label||b,e=c.name||b,i=c.attributes||{},a=Object.keys(i).map(function(a){return a+"=\""+i[a]+"\""}).join(" ");h+="<label><input type=\""+(c.type||"text")+"\" name=\""+e+"\""+("checkbox"===c.type&&c.value?" checked=\"checked\"":" value=\""+(c.value||"").replace(/"/g,"&quot;"))+"\""+a+"><span class=\""+f+"input-infos\"><span>"+(g[d]?g[d]:d)+"</span></span></label>"}),e.openModal(a,h).on("tbwconfirm",function(){var a=d("form",d(this)),f=!0,g={};d.each(b,function(b,c){var h=c.name||b,i=d("input[name=\""+h+"\"]",a),j=i.attr("type");switch(j.toLowerCase()){case"checkbox":g[h]=i.is(":checked");break;case"radio":g[h]=i.filter(":checked").val();break;default:g[h]=d.trim(i.val());}c.required&&""===g[h]?(f=!1,e.addErrorOnModalField(i,e.lang.required)):c.pattern&&!c.pattern.test(g[h])&&(f=!1,e.addErrorOnModalField(i,c.patternError))}),f&&(e.restoreRange(),c(g,b)&&(e.syncCode(),e.$c.trigger("tbwchange"),e.closeModal(),d(this).off("tbwconfirm")))}).one("tbwcancel",function(){d(this).off("tbwconfirm"),e.closeModal()})},addErrorOnModalField:function(a,b){var c=this.o.prefix,e=c+"msg-error",f=a.parent();a.on("change keyup",function(){f.removeClass(c+"input-error"),setTimeout(function(){f.find("."+e).remove()},150)}),f.addClass(c+"input-error").find("input+span").append(d("<span/>",{class:e,text:b}))},getDefaultImgDblClickHandler:function(){var a=this;return function(){var b=d(this),c=b.attr("src");0===c.indexOf("data:image")&&(c="(Base64)");var e={url:{label:"URL",value:c,required:!0},alt:{label:a.lang.description,value:b.attr("alt")}};return a.o.imageWidthModalEdit&&(e.width={value:b.attr("width")?b.attr("width"):""}),a.openModalInsert(a.lang.insertImage,e,function(c){return"(Base64)"!==c.url&&b.attr({src:c.url}),b.attr({alt:c.alt}),a.o.imageWidthModalEdit&&(0<parseInt(c.width)?b.attr({width:c.width}):b.removeAttr("width")),!0}),!1}},saveRange:function(){var a=this,b=a.doc.getSelection();if(a.range=null,b&&b.rangeCount){var c,d=a.range=b.getRangeAt(0),e=a.doc.createRange();e.selectNodeContents(a.$ed[0]),e.setEnd(d.startContainer,d.startOffset),c=(e+"").length,a.metaRange={start:c,end:c+(d+"").length}}},restoreRange:function(){var a,b=this,c=b.metaRange,d=b.range,e=b.doc.getSelection();if(d){if(c&&c.start!==c.end){var f,g=0,h=[b.$ed[0]],j=!1,k=!1;for(a=b.doc.createRange();!k&&(f=h.pop());)if(3===f.nodeType){var l=g+f.length;!j&&c.start>=g&&c.start<=l&&(a.setStart(f,c.start-g),j=!0),j&&c.end>=g&&c.end<=l&&(a.setEnd(f,c.end-g),k=!0),g=l}else for(var m=f.childNodes,n=m.length;0<n;)n-=1,h.push(m[n])}try{e.removeAllRanges()}catch(a){}e.addRange(a||d)}},getRangeText:function(){return this.range+""},clearButtonPaneStatus:function(){var a=this,b=a.o.prefix,c=b+"original-icon";d("."+b+"active-button",a.$btnPane).removeClass(b+"active-button "+b+"active"),d("."+c,a.$btnPane).each(function(){d(this).find("svg use").attr("xlink:href",d(this).data(c))})},updateButtonPaneStatus:function(){var a=this,b=a.o.prefix,c=b+"active-button "+b+"active",e=b+"original-icon",f=a.getTagsRecursive(a.doc.getSelection().focusNode);a.clearButtonPaneStatus(),d.each(f,function(f,g){var h=a.tagToButton[g.toLowerCase()],i=d("."+b+h+"-button",a.$btnPane);if(0<i.length)i.addClass(c);else try{i=d("."+b+"dropdown ."+b+h+"-dropdown-button",a.$box);var j=i.find("svg use"),k=i.parent().data(b+"dropdown"),l=d("."+b+k+"-button",a.$box),m=l.find("svg use");l.addClass(c),a.o.changeActiveDropdownIcon&&0<j.length&&(l.addClass(e).data(e,m.attr("xlink:href")),m.attr("xlink:href",j.attr("xlink:href")))}catch(a){}})},getTagsRecursive:function(a,b){var c=this;if(b=b||(a&&a.tagName?[a.tagName]:[]),a&&a.parentNode)a=a.parentNode;else return b;var e=a.tagName;return"DIV"===e?b:("P"===e&&""!==a.style.textAlign&&b.push(a.style.textAlign),d.each(c.tagHandlers,function(d,e){b=b.concat(e(a,c))}),b.push(e),c.getTagsRecursive(a,b).filter(function(a){return null!=a}))},initPlugins:function(){var a=this;a.loadedPlugins=[],d.each(d.trumbowyg.plugins,function(b,c){(!c.shouldInit||c.shouldInit(a))&&(c.init(a),c.tagHandler&&a.tagHandlers.push(c.tagHandler),a.loadedPlugins.push(c))})},destroyPlugins:function(){var a=this;d.each(this.loadedPlugins,function(b,c){c.destroy&&c.destroy(a)})}}}(navigator,window,document,jQuery);